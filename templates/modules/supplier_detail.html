{% extends 'base.html' %}
{% load formatting %}

{% block title %}Supplier | Jambas Imaging{% endblock %}

{% block content %}
  <!-- Header Section -->
  <div class="d-flex align-items-start justify-content-between flex-wrap gap-3 mb-4">
    <div>
      <div class="d-flex align-items-center gap-2 mb-2">
        <i class="bi bi-building text-primary" style="font-size: 1.8rem;"></i>
        <div>
          <h1 class="h3 mb-0">{{ supplier.name }}</h1>
          <div class="text-muted small">Supplier information &amp; pricing details</div>
        </div>
      </div>
    </div>
    <div class="d-flex gap-2 align-items-center flex-shrink-0">
      <a class="btn btn-primary btn-sm d-inline-flex align-items-center gap-1" href="{% url 'add_supplier_price' %}?supplier={{ supplier.id }}">
        <i class="bi bi-plus-lg"></i>
        <span>Add price</span>
      </a>
      <a class="btn btn-outline-secondary btn-sm d-inline-flex align-items-center gap-1" href="{% url 'edit_supplier' supplier.id %}">
        <i class="bi bi-pencil"></i>
        <span>Edit</span>
      </a>
    </div>
  </div>

  <div class="row g-4">
    <!-- Supplier Info Card: Full Width on Top -->
    <div class="col-12">
      <div class="card shadow-sm border-0">
        <div class="card-header bg-white border-bottom border-light">
          <div class="d-flex align-items-center gap-2 mb-0">
            <i class="bi bi-telephone text-primary"></i>
            <span class="fw-600">Contact Information</span>
          </div>
        </div>
        <div class="card-body">
          <div class="row g-4">
            <!-- Contact Person -->
            <div class="col-12 col-sm-6 col-lg-3">
              <div class="text-muted small fw-500 mb-2">Contact Person</div>
              <div class="h6 mb-0">{{ supplier.contact_person|default:"Not specified" }}</div>
            </div>

            <!-- Phone -->
            <div class="col-12 col-sm-6 col-lg-3">
              <div class="text-muted small fw-500 mb-2">Phone</div>
              <div>
                {% if supplier.phone %}
                  <a href="tel:{{ supplier.phone }}" class="text-decoration-none">{{ supplier.phone }}</a>
                  {% if supplier.alt_phone %}
                    <div class="small text-muted">/ <a href="tel:{{ supplier.alt_phone }}" class="text-decoration-none">{{ supplier.alt_phone }}</a></div>
                  {% endif %}
                {% else %}
                  <span class="text-muted">Not specified</span>
                {% endif %}
              </div>
            </div>

            <!-- Email -->
            <div class="col-12 col-sm-6 col-lg-3">
              <div class="text-muted small fw-500 mb-2">Email</div>
              <div>
                {% if supplier.email %}
                  <a href="mailto:{{ supplier.email }}" class="text-decoration-none">{{ supplier.email }}</a>
                {% else %}
                  <span class="text-muted">Not specified</span>
                {% endif %}
              </div>
            </div>

            <!-- Website -->
            <div class="col-12 col-sm-6 col-lg-3">
              <div class="text-muted small fw-500 mb-2">Website</div>
              <div>
                {% if supplier.website %}
                  <a href="{{ supplier.website }}" target="_blank" class="text-decoration-none">{{ supplier.website }} <i class="bi bi-box-arrow-up-right ms-1" style="font-size: 0.75rem;"></i></a>
                {% else %}
                  <span class="text-muted">Not specified</span>
                {% endif %}
              </div>
            </div>

            <!-- Address -->
            <div class="col-12 col-lg-6">
              <div class="text-muted small fw-500 mb-2">Address</div>
              <div>{{ supplier.address|default:"Not specified" }}</div>
            </div>

            <!-- TIN -->
            <div class="col-12 col-lg-3">
              <div class="text-muted small fw-500 mb-2">Tax ID (TIN)</div>
              <div class="font-monospace small">{{ supplier.tin|default:"Not specified" }}</div>
            </div>

            <!-- Status -->
            <div class="col-12 col-lg-3">
              <div class="text-muted small fw-500 mb-2">Status</div>
              {% if supplier.is_active %}
                <span class="badge bg-success-subtle text-success border border-success-subtle">
                  <i class="bi bi-check-circle me-1"></i>Active
                </span>
              {% else %}
                <span class="badge bg-secondary-subtle text-secondary border border-secondary-subtle">
                  <i class="bi bi-x-circle me-1"></i>Inactive
                </span>
              {% endif %}
            </div>

            <!-- Notes (Full Width) -->
            {% if supplier.notes %}
              <div class="col-12 pt-3 border-top border-light">
                <div class="text-muted small fw-500 mb-2">Notes</div>
                <div class="small text-body">{{ supplier.notes }}</div>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Captured Prices Card: Full Width Below -->
    <div class="col-12">
      <div class="card shadow-sm border-0 d-flex flex-column">
        <div class="card-header bg-white border-bottom border-light">
          <div class="d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center gap-2 mb-0">
              <i class="bi bi-tag text-primary"></i>
              <span class="fw-600">Captured Prices &amp; Terms</span>
              <span class="badge bg-light text-muted ms-2">{{ prices|length }}</span>
            </div>
          </div>
        </div>
        <div class="card-body p-0 flex-grow-1">
          {% if prices %}
            <div class="table-responsive">
              <table class="table table-sm mb-0 align-middle">
                <thead class="table-light">
                  <tr>
                    <th class="border-bottom-2">What they supply</th>
                    <th class="text-center border-bottom-2">Unit</th>
                    <th class="text-end border-bottom-2">Unit Price</th>
                    <th class="text-center border-bottom-2">Min order</th>
                    <th class="text-center border-bottom-2">Lead time</th>
                    <th class="text-center border-bottom-2">Quoted</th>
                    <th class="text-center border-bottom-2">Status</th>
                    <th class="text-center border-bottom-2" style="width: 80px;">Actions</th>
                  </tr>
                </thead>
                <tbody class="border-top-0">
                  {% for p in prices %}
                    <tr class="border-bottom-1 hover-row" style="transition: background-color 0.15s;">
                      <td class="fw-500">
                        <div class="mb-1">
                          {% if p.item_name %}
                            {{ p.item_name }}
                          {% elif p.product %}
                            {{ p.product.name }}
                          {% else %}
                            <span class="text-muted">—</span>
                          {% endif %}
                        </div>
                        {% if p.product %}
                          <div class="text-muted small">{{ p.product.sku }}</div>
                        {% endif %}
                      </td>
                      <td class="text-center text-muted small">
                        {{ p.quantity_unit|default:"—" }}
                      </td>
                      <td class="text-end fw-600">
                        <span class="text-primary">{{ p.unit_price|money }}</span>
                        <span class="text-muted small ms-1">{{ p.currency }}</span>
                      </td>
                      <td class="text-center small">
                        {% if p.min_order_quantity %}
                          <span class="badge bg-light text-muted">{{ p.min_order_quantity }}</span>
                        {% else %}
                          <span class="text-muted">—</span>
                        {% endif %}
                      </td>
                      <td class="text-center small">
                        {% if p.lead_time_days %}
                          <span class="badge bg-info-subtle text-info">{{ p.lead_time_days }}d</span>
                        {% else %}
                          <span class="text-muted">—</span>
                        {% endif %}
                      </td>
                      <td class="text-center small text-muted">
                        {{ p.quoted_at|date:"d M y" }}
                      </td>
                      <td class="text-center">
                        {% if p.is_active %}
                          <span class="badge bg-success-subtle text-success">Active</span>
                        {% else %}
                          <span class="badge bg-secondary-subtle text-secondary">Inactive</span>
                        {% endif %}
                      </td>
                      <td class="text-center">
                        <div class="d-flex gap-1 justify-content-center">
                          <a
                            href="{% url 'edit_supplier_price' p.id %}"
                            class="btn btn-sm btn-outline-primary d-inline-flex align-items-center justify-content-center"
                            title="Edit this supply"
                            style="width: 32px; height: 32px; padding: 0;"
                          >
                            <i class="bi bi-pencil-fill"></i>
                          </a>
                          <form
                            method="post"
                            action="{% url 'delete_supplier_price' p.id %}"
                            class="d-inline"
                            onsubmit="return confirm('Delete this supply/price?');"
                          >
                            {% csrf_token %}
                            <button
                              type="submit"
                              class="btn btn-sm btn-outline-danger d-inline-flex align-items-center justify-content-center"
                              title="Delete this supply"
                              style="width: 32px; height: 32px; padding: 0;"
                            >
                              <i class="bi bi-trash-fill"></i>
                            </button>
                          </form>
                        </div>
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <div class="d-flex flex-column align-items-center justify-content-center py-5 text-muted">
              <i class="bi bi-inbox" style="font-size: 3rem; opacity: 0.3; margin-bottom: 1rem;"></i>
              <div class="h6">No prices captured yet</div>
              <p class="small">Add your first supply and pricing information.</p>
              <a href="{% url 'add_supplier_price' %}?supplier={{ supplier.id }}" class="btn btn-sm btn-primary mt-2">
                <i class="bi bi-plus-lg me-1"></i>Add first price
              </a>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
    </div>

  <style>
    .hover-row:hover {
      background-color: rgba(0, 123, 255, 0.03) !important;
    }
    .border-bottom-2 {
      border-bottom: 2px solid var(--bs-light) !important;
    }
    .border-bottom-1 {
      border-bottom: 1px solid var(--bs-light) !important;
    }
    .fw-600 {
      font-weight: 600;
    }
    .bg-success-subtle {
      background-color: rgba(25, 135, 84, 0.1) !important;
    }
    .bg-info-subtle {
      background-color: rgba(13, 202, 240, 0.1) !important;
    }
    .text-success {
      color: #198754 !important;
    }
    .text-info {
      color: #0dcaf0 !important;
    }
    .bg-secondary-subtle {
      background-color: rgba(108, 117, 125, 0.1) !important;
    }
    .text-secondary {
      color: #6c757d !important;
    }
  </style>
{% endblock %}
